<VirtualHost *:80>

	ServerName hda

	ServerAlias hda.@HDA_DOMAIN@

	ProxyPassMatch ^/(assets|packs|themes)/ !
	ProxyPass / http://localhost:9292/
	ProxyPassReverse / http://localhost:9292/

	DocumentRoot /var/hda/platform/html/public/

	RewriteEngine On
	RewriteCond %{REQUEST_URI} ^/(assets|packs|themes)
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -f
	RewriteRule $1 [PT,L]

	<Directory "/var/hda/platform/html/public/" >
		Options Indexes FollowSymLinks MultiViews
		AllowOverride All
		Order allow,deny
		Allow from all
		Require all granted
	</Directory>

	<LocationMatch "/(assets|packs|themes)/">
		# Use of ETag is discouraged when Last-Modified is present
		Header unset ETag
		FileETag None
		# RFC says only cache for 1 year
		ExpiresActive On
		ExpiresDefault "access plus 1 year"
		Require all granted
	</LocationMatch>

	ErrorDocument 500 "<h2>Application error</h2>Rails application failed to start properly"

	ErrorLog  /var/hda/platform/logs/error_log
	CustomLog /var/hda/platform/logs/access_log combined env=!dontlog

</VirtualHost>
